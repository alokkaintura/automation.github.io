<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <title>SOP</title>
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
    <!-- Font Awesome icons (free version)-->
    <script src="https://use.fontawesome.com/releases/v5.15.3/js/all.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <script src="script.js"></script>
    <!-- Google fonts-->
    <link href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css" />
   
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css" />
</head>
<style>
    
    body {
        -webkit-user-select: none;
        -webkit-touch-callout: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
    }
    
    span.head {
        font-weight: 700;
    }
    
    .section-heading {
        color: #0067b8;
    }
    
    .header {
        position: relative;
        text-align: center;
        background: linear-gradient(60deg, rgba(84, 58, 183, 1) 0%, rgba(0, 172, 193, 1) 100%);
        color: white;
    }
    
    .inner-header {
        height: 65vh;
        width: 100%;
        margin: 0;
        padding: 0;
    }
    
    .flex {
        /*Flexbox for containers*/
        display: flex;
        justify-content: center;
        align-items: center;
        text-align: center;
    }
    
    .waves {
        position: relative;
        width: 100%;
        height: 15vh;
        margin-bottom: -7px;
        /*Fix for safari gap*/
        min-height: 100px;
        max-height: 150px;
    }
    
    .content {
        position: relative;
        height: 20vh;
        text-align: center;
        background-color: white;
    }
    /* Animation */
    
    .parallax>use {
        animation: move-forever 25s cubic-bezier(.55, .5, .45, .5) infinite;
    }
    
    .parallax>use:nth-child(1) {
        animation-delay: -2s;
        animation-duration: 7s;
    }
    
    .parallax>use:nth-child(2) {
        animation-delay: -3s;
        animation-duration: 10s;
    }
    
    .parallax>use:nth-child(3) {
        animation-delay: -4s;
        animation-duration: 13s;
    }
    
    .parallax>use:nth-child(4) {
        animation-delay: -5s;
        animation-duration: 20s;
    }
    
    @keyframes move-forever {
        0% {
            transform: translate3d(-90px, 0, 0);
        }
        100% {
            transform: translate3d(85px, 0, 0);
        }
    }
    /*Shrinking for mobile*/
    
    @media (max-width: 768px) {
        .waves {
            height: 40px;
            min-height: 40px;
        }
        .content {
            height: 30vh;
        }
        h1 {
            font-size: 24px;
        }
    }
</style>
<script>
</script>

<body>
    <!--Hey! This is the original version
of Simple CSS Waves-->

    <div class="header">

        <!--Content before waves-->
        <div class="inner-header flex">
            <!--Just the logo.. Don't mind this-->

            <path fill="#FFFFFF" stroke="#000000" stroke-width="10" stroke-miterlimit="10" d="M57,283" />
            <g>
                <path fill="#fff" d="M250.4,0.8C112.7,0.8,1,112.4,1,250.2c0,137.7,111.7,249.4,249.4,249.4c137.7,0,249.4-111.7,249.4-249.4
    C499.8,112.4,388.1,0.8,250.4,0.8z M383.8,326.3c-62,0-101.4-14.1-117.6-46.3c-17.1-34.1-2.3-75.4,13.2-104.1
    c-22.4,3-38.4,9.2-47.8,18.3c-11.2,10.9-13.6,26.7-16.3,45c-3.1,20.8-6.6,44.4-25.3,62.4c-19.8,19.1-51.6,26.9-100.2,24.6l1.8-39.7		c35.9,1.6,59.7-2.9,70.8-13.6c8.9-8.6,11.1-22.9,13.5-39.6c6.3-42,14.8-99.4,141.4-99.4h41L333,166c-12.6,16-45.4,68.2-31.2,96.2	c9.2,18.3,41.5,25.6,91.2,24.2l1.1,39.8C390.5,326.2,387.1,326.3,383.8,326.3z"
                />
            </g>
            </svg>
            <h1>Initialize a Transactional Replication from a Database Backup </h1>
            <br> <a href="/index.html" style="color: white;text-decoration: underline;">Home</a>
        </div>

        <!--Waves Container-->
        <div>
            <svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
    <defs>
    <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" />
    </defs>
    <g class="parallax">
    <use xlink:href="#gentle-wave" x="48" y="0" fill="rgba(255,255,255,0.7" />
    <use xlink:href="#gentle-wave" x="48" y="3" fill="rgba(255,255,255,0.5)" />
    <use xlink:href="#gentle-wave" x="48" y="5" fill="rgba(255,255,255,0.3)" />
    <use xlink:href="#gentle-wave" x="48" y="7" fill="#fff" />
    </g>
    </svg>
        </div>
        <!--Waves end-->

    </div>
    <!--Header ends-->
    <br><br><br>


    <!--Content ends-->
    <!-- Post Content-->
    <article class="mb-4">
        <div class="container px-4 px-lg-5">
            <div class="row gx-4 gx-lg-5 justify-content-center">
                <div class="col-md-10 col-lg-8 col-xl-7">
                    <!--<h2 class="section-heading">How to configure replication using replication support only </h2>-->
                    <p>
                        August 5, 2012 · Klaus Aschenbrenner <br><br>
                        (Be sure to checkout the FREE SQLpassion Performance Tuning Training Plan - you get a weekly email packed with all the essential knowledge you need to know about performance tuning on SQL Server.) <br>
                     
During the last days I’m working on Replication – especially with Transactional Replication. The main idea of Transactional Replication is that you have a so-called Log Reader Agent on your Publisher SQL Server database running, that is analyzing the Transaction Log File and synchronize changes on so-called Articles through a Distribution database down to your Subscription databases.
<br>
When you setup your Transactional Replication through SQL Server Management Studio, you can only initialize the Subscription database through a so-called Snapshot. A snapshot is just a point-in-time “picture” of your database, which is dumped out to a file share through bcp.exe. Imagine now that you want to publish parts of a VLDB (Very Large Database) to various Subscribers. In that case Transactional Replication must make a snapshot on the Articles that you want to replicate from your VLDB. That’s not very practical, because it can take a very long time to make that snapshot and initialize the Subscribers from that snapshot. <br>
Fortunately there is also an option to initialize a Subscriber from a backup file, but unfortunately this option isn’t available through SQL Server Management Studio – you have to choose that option through the Replication Stored Procedures that are used in the background by SQL Server to implement the actual Replication. The idea of initializing a Transactional Replication from a backup file is not very new, because there are also other blog postings on this topic, but I wasn’t able to find a step-by-step tutorial how to implement this approach. The most important blog posting is from Chris Skorlinski (http://blogs.msdn.com/b/repltalk/archive/2010/03/16/deep-dive-on-initialize-from-backup-for-transactional-replication.aspx). With the information provided in that posting I was finally able to do the initialization from a backup file. In this blog posting I want to show you now step-by-step how you can achieve that functionality. <br>
In my distributed scenario Transactional Replication is running on 3 different VMs: <br>
<ul>
    <li> SQL2008HADR1: Publisher</li>
    <li> SQL2008HADR2: Distributor</li>
    <li> SQL2008HADR3: Subscriber</li>
</ul>
Running Replication in a fully distributed scenario is more realistic, but the setup of the needed security is also a topic on its own. Fortunately Joe Sack from SQLskills.com has written a few weeks ago a very nice article how to setup security – see http://www.sqlskills.com/blogs/joe/post/SQL-Server-Pro-articlee28093e2809cGetting-Started-with-Transactional-Replicatione2809d.aspx for further details on that. To get started I have created a completely new database on SQL2008HADR1 which acts as the Publisher for Transactional Replication: <br>

</p>
                   
                    <img src="/soplink/replication2.png" alt="">
                    <P>As you can see from the code, I have created a simple table called Foo, and inserted several records into that table. I have also created a full database backup and afterwards I have inserted several other records, which are currently stored in no backup. In the next step you have to create your Publication on the Publisher. This can be done completely through the UI provided by SQL Server Management Studio. The only thing that you don’t have to do is the creation of an initial snapshot, because we don’t need that snapshot.
 
                    </P>
                    <img src="/soplink/replication3.png" alt="">
                    <p>In my case I have scripted out the creation of the Publication, which resulted in the following T-SQL code</p>
                 <div style="display: flex;flex-direction: column;">
                    <textarea id="replication" style="color: #0067b8;font-weight: 600;user-select: text;font-size: 12px;">
                        USE PublisherDatabase
                        GO
                         
                        EXEC sp_replicationdboption
                            @dbname = N'PublisherDatabase', 
                            @optname = N'publish', 
                            @value = N'true'
                        GO
                         
                        -- Adding the transactional publication
                        EXEC sp_addpublication
                            @publication = N'FooPublication', 
                            @description = N'Transactional publication of database ''PublisherDatabase'' from Publisher ''SQL2008HADR1''.', 
                            @sync_method = N'concurrent', 
                            @retention = 0, 
                            @allow_push = N'true', 
                            @allow_pull = N'true', 
                            @allow_anonymous = N'false', 
                            @enabled_for_internet = N'false', 
                            @snapshot_in_defaultfolder = N'true', 
                            @compress_snapshot = N'false', 
                            @ftp_port = 21, 
                            @allow_subscription_copy = N'false', 
                            @add_to_active_directory = N'false', 
                            @repl_freq = N'continuous', 
                            @status = N'active', 
                            @independent_agent = N'true', 
                            @immediate_sync = N'false', 
                            @allow_sync_tran = N'false', 
                            @allow_queued_tran = N'false', 
                            @allow_dts = N'false',
                            @replicate_ddl = 1, 
                            @allow_initialize_from_backup = N'false', 
                            @enabled_for_p2p = N'false', 
                            @enabled_for_het_sub = N'false'
                        GO
                         
                        -- Add the Snapshot Agent for the Publication
                        EXEC sp_addpublication_snapshot
                            @publication = N'FooPublication', 
                            @frequency_type = 1, 
                            @frequency_interval = 1, 
                            @frequency_relative_interval = 1,
                            @frequency_recurrence_factor = 0, 
                            @frequency_subday = 8, 
                            @frequency_subday_interval = 1, 
                            @active_start_time_of_day = 0, 
                            @active_end_time_of_day = 235959,
                            @active_start_date = 0, 
                            @active_end_date = 0, 
                            @job_login = null, 
                            @job_password = null, 
                            @publisher_security_mode = 1
                        GO
                         
                        -- Add an Article to the Publication
                        EXEC sp_addarticle
                            @publication = N'FooPublication', 
                            @article = N'Foo', 
                            @source_owner = N'dbo', 
                            @source_object = N'Foo', 
                            @type = N'logbased', 
                            @description = null, 
                            @creation_script = null, 
                            @pre_creation_cmd = N'drop', 
                            @schema_option = 0x000000000803509F, 
                            @identityrangemanagementoption = N'manual', 
                            @destination_table = N'Foo', 
                            @destination_owner = N'dbo', 
                            @vertical_partition = N'false', 
                            @ins_cmd = N'CALL sp_MSins_dboFoo', 
                            @del_cmd = N'CALL sp_MSdel_dboFoo', 
                            @upd_cmd = N'SCALL sp_MSupd_dboFoo'
                        GO</textarea>
                    <!-- Trigger -->
                    <button class="btn" data-clipboard-action="copy" data-clipboard-target="#replication" style="background-color: rgb(252, 252, 252);font-weight: 500;width: 400px;margin: auto;">
                        Copy to clipboard
                    </button>
                </div>
                
                </div>
            </div>
        </div>
    </article>
    <!-- Footer--><br><br><br>
    <footer class="border-top">
        <div class="container px-4 px-lg-5">
            <div class="row gx-4 gx-lg-5 justify-content-center">
                <div class="col-md-10 col-lg-8 col-xl-7">
                    <ul class="list-inline text-center">
                        <li class="list-inline-item">
                            <a href="https://www.linkedin.com/company/scalability-engineers/?viewAsMember=true">
                                <span class="fa-stack fa-lg">
                                    <i class="fas fa-circle fa-stack-2x"></i>
                                    <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                        <li class="list-inline-item">
                            <a href="https://www.facebook.com/scalabilityengineers/">
                                <span class="fa-stack fa-lg">
                                    <i class="fas fa-circle fa-stack-2x"></i>
                                    <i class="fab fa-facebook-f fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                        <li class="list-inline-item">
                            <a href="https://www.instagram.com/scalabilityengineers/">
                                <span class="fa-stack fa-lg">
                                    <i class="fas fa-circle fa-stack-2x"></i>
                                    <i class="fab fa-instagram fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    </ul>
                    <div class="small text-center text-muted fst-italic">Copyright &copy; Scalability Enigineers</div>
                </div>
            </div>
        </div>
    </footer>

</body>

</html>