<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <link href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <title>Script</title>
    <script src="script.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>


    <style>
        body {
            -webkit-user-select: none;
            -webkit-touch-callout: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        .card-body p {
            font-weight: 600;
            color: #383f56;
            margin-left: 10px;
        }
        
        li {
            font-size: 14px;
            margin-left: 30px
        }
        
        .script {
            padding-top: 70px;
            width: 70%;
            margin: auto;
        }
        
        .btn-info {
            width: 100px;
        }
        
        span.quries {
            font-weight: 500;
            color: #0067b8;
            -webkit-user-select: text;
            -webkit-touch-callout: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }
        /**clipboard*/
    </style>
    <script>
    </script>


</head>



<body>



    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid"> <a class="navbar-brand" href="#">SE DOCUMENTATION</a> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav mr-auto mb-2 mb-lg-0">
                    <li class="nav-item"> <a class="nav-link" href="index.html">Home</a> </li>
                    <li class="nav-item"> <a class="nav-link" href="sop.html">SOP</a> </li>
                    <!--     <li class="nav-item"> <a class="nav-link" href="vlog.html">Vlog</a> </li> -->
                    <li class="nav-item"> <a class="nav-link active" aria-current="page" href="script.html">Script</a> </li>
                    <!-- <li class="nav-item dropdown"> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-expanded="false"> Services </a>
                        <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <li><a class="dropdown-item" href="#">Social Media</a></li>
                            <li><a class="dropdown-item" href="#">Google Ads</a></li>
                            <li><a class="dropdown-item" href="#">Facebook Ads</a></li>
                        </ul>
                    </li>-->
                </ul>
                <div class="d-flex">
                    <ul>
                        <li><span class="social-icon social-facebook"><i class="fa fa-facebook"></i></span></li>

                        <li><span class="social-icon social-linkedin"><i class="fa fa-linkedin"></i></span></li>
                        <li><span class="social-icon social-instagram"><i class="fa fa-instagram"></i></span></li>

                    </ul>
                </div>
            </div>
        </div>
    </nav>



    <!---hero-->

    <div class="container">
        <div class="row align-items-center">
            <div class="col-md-7 col-12 order-md-1 order-2">
                <h4 style="font-size: 35px;color:#0067b8;">Script</h4>
                <p></p> <br>
                <a href="#"></a>
            </div>
            <div class="col-md-5 col-12 order-md-2 order-1"><img src="https://raw.githubusercontent.com/alokkaintura/alok/master/undraw_Organizing_projects_0p9a.svg" class="mx-auto" alt="slide"></div>
        </div>
    </div>
    </div>
    </div>
    <!--hero end-->


    <div class="script">
        <div class="auto-container">

            <div class="accordion" id="accordionExample">
                <div class="card">
                    <div class="card-header" id="headingOne">
                        <h2 class="mb-0">
                            <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
              1. Replication
              </button>
                        </h2>
                    </div>

                    <div id="collapseOne" class="collapse" aria-labelledby="headingOne" data-parent="#accordionExample">
                        <div class="card-body">
                            <p class="btn btn-primary" data-toggle="modal" data-target=".create-publication" style="border-radius: 500px;background-color: white;border-color: white;color: #0067b8; font-size: 13px;font-weight: 500;text-decoration: underline;">Create publication </p>
                            <br>
                            <p class="btn btn-primary" data-toggle="modal" data-target=".etl-rpt" style="border-radius: 500px;background-color: white;border-color: white;color: #0067b8; font-size: 13px;font-weight: 500;text-decoration: underline;">ETL RPT Coreissue Sub </p>
<br>
<p class="btn btn-primary" data-toggle="modal" data-target=".transact-sql" style="border-radius: 500px;background-color: white;border-color: white;color: #0067b8; font-size: 13px;font-weight: 500;text-decoration: underline;">Transact-SQL Script to Monitor Replication status</p>
<br>
<p class="btn btn-primary" data-toggle="modal" data-target=".tsqlcode" style="border-radius: 500px;background-color: white;border-color: white;color: #0067b8; font-size: 13px;font-weight: 500;text-decoration: underline;">T-SQL code to review replication configuration</p>
<br>                            



                            <li></li>
                            </ul>

                            <p>Time sync table</p>

                            <p>Replication Monitor</p>
                            <ul>
                                <li>&#8226 Show pending commands</li>
                                <li>&#8226 Replication Agent status</li>
                                <li>&#8226 Error message troublshooting</li>
                                <li>&#8226 Tracer Token</li>
                            </ul>
                            <p>Replication Monitoring</p>
                            <ul>
                                <li>&#8226 sp_replcounter</li>
                                <li>&#8226 Distribution to Subsriber latency</li>
                                <li>&#8226 Pending command to be replicated</li>
                                <li>&#8226 Speed of replication of commands</li>
                            </ul>
                            <p>Replication configuration</p>
                            <ul>
                                <li>&#8226 Add complete article</li>
                                <li>&#8226 Add article with limited columns</li>
                                <li>&#8226 Add publication snapshot</li>
                                <li>&#8226 Add publication without snapshot</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header" id="headingTwo">
                        <h2 class="mb-0">
                            <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                            2. AdminDB
              </button>
                        </h2>
                    </div>
                    <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordionExample">
                        <div class="card-body">
                            <p>SQL Jobs</p>
                            <ul>
                                <li>&#8226 Find jobs which are not owned by SA</li>
                            </ul>
                            <p>Indexes
                            </p>
                            <ul>
                                <li>&#8226 check index fragmentation level
                                </li>
                            </ul>
                            <p>Space</p>
                            <ul>
                                <li>&#8226 Overall space report
                                </li>
                                <li>&#8226 tables with large rows and space

                                </li>
                            </ul>
                            <p>Counters</p>
                            <ul>
                                <li>&#8226 Find jobs which are not owned by SA</li>
                                <li>&#8226 PLE</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header" id="headingThree">
                        <h2 class="mb-0">
                            <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                3. Backups
              </button>
                        </h2>
                    </div>
                    <div id="collapseThree" class="collapse" aria-labelledby="headingThree" data-parent="#accordionExample">
                        <div class="card-body">
                            <p>Migrating database from one instance to another
                            </p>
                            <p>Take simple backup
                            </p>
                            <p>Take multi stripe backup
                            </p>
                            <p>backup on UNC path
                            </p>
                            <p>Take compressed backup
                            </p>
                            <p>Monitor backup progress using DMVs
                            </p>
                            <p>Monitor backup progress using backup status option
                            </p>

                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header" id="headingFour">
                        <h2 class="mb-0">
                            <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
                            3. Database Properties

              </button>
                        </h2>
                    </div>

                    <div id="collapseFour" class="collapse" aria-labelledby="headingFour" data-parent="#accordionExample">
                        <div class="card-body">
                            <p>Database Options

                            </p>
                            <p>Managing and Configuring Database

                            </p>
                            <p>Database files and FileGroups

                            </p>
                            <p>Recovery Model

                            </p>
                            <p>Introduction about the isolation levels.

                            </p>
                            <p>Isolation level

                            </p>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header" id="headingfive">
                        <h2 class="mb-0">
                            <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapsefive" aria-expanded="false" aria-controls="collapsefive">
                4. Error Logs
              </button>
                        </h2>
                    </div>
                    <div id="collapsefive" class="collapse" aria-labelledby="headingfive" data-parent="#accordionExample">
                        <div class="card-body">
                            <p>SQL Server Error log

                            </p>
                            <p>Overview
                            </p>
                            <p>Scanning the error logs for issues

                            </p>
                            <p>Location of the error log

                            </p>
                            <p>selective search of the errorlog

                            </p>
                            <p>SQL Agent Error Log

                            </p>
                            <p>Windows Event Log (Application,security and system)

                            </p>

                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header" id="headingsix">
                        <h2 class="mb-0">
                            <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapsesix" aria-expanded="false" aria-controls="collapsesix">
                5. HADR
              </button>
                        </h2>
                    </div>
                    <div id="collapsesix" class="collapse" aria-labelledby="headingsix" data-parent="#accordionExample">
                        <div class="card-body">
                            <p>Log Shipping
                            </p>
                            <p>Clustering

                            </p>
                            <p>AlwaysOn

                            </p>
                            <p>Replication
                            </p>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header" id="headingseven">
                        <h2 class="mb-0">
                            <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseseven" aria-expanded="false" aria-controls="collapseseven">
                            6. Indexes

              </button>
                        </h2>
                    </div>
                    <div id="collapseseven" class="collapse" aria-labelledby="headingseven" data-parent="#accordionExample">
                        <div class="card-body">





                            <p class="btn btn-primary" data-toggle="modal" data-target=".bd-example-modal-lg" style="border-radius: 500px;background-color: white;border-color: white;color: #0067b8; font-size: 13px;font-weight: 500;text-decoration: underline;">Online rebuild</p>

                            <br>

                            <p class="btn btn-primary" data-toggle="modal" data-target=".bd-example-modal-lg1" style="border-radius: 500px;background-color: white;border-color: white;color: #0067b8; font-size: 13px;font-weight: 500;text-decoration: underline;">Fragmentation</p>


                            <p>Maxdop Setting

                            </p>
                            <p>Sort in tempdb

                            </p>
                            <p> Filtered index

                            </p>
                            <p>Covering indexes

                            </p>
                            <p>rebuild of partitioned indexes

                            </p>
                            <p>Enabling or disabling of indexes

                            </p>
                            <p>Compression of indexes (page and row)

                            </p>
                            <p>Best practices of index creation

                            </p>
                            <p>Check the lock availability

                            </p>
                            <p>Check the log usage (will impact repl, AO)

                            </p>
                            <p>Check the index creation percentage

                            </p>

                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header" id="headingeight">
                        <h2 class="mb-0">
                            <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseeight" aria-expanded="false" aria-controls="collapseeight">
                                7. Misc
              </button>
                        </h2>
                    </div>
                    <div id="collapseeight" class="collapse" aria-labelledby="headingright" data-parent="#accordionExample">
                        <div class="card-body">
                            <p>Exporting and importing data
                            </p>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header" id="headingnine">
                        <h2 class="mb-0">
                            <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapsenine" aria-expanded="false" aria-controls="collapsenine">
                                8. Restore

              </button>
                        </h2>
                    </div>
                    <div id="collapsenine" class="collapse" aria-labelledby="headingright" data-parent="#accordionExample">
                        <div class="card-body">
                            <p>Restore

                            </p>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header" id="headingnine">
                        <h2 class="mb-0">
                            <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapsenine" aria-expanded="false" aria-controls="collapsenine">
                                9. SQL Server Security


              </button>
                        </h2>
                    </div>
                    <div id="collapsenine" class="collapse" aria-labelledby="headingright" data-parent="#accordionExample">
                        <div class="card-body">
                            <p>Logins
                            </p>
                            <p>Server Level permissions

                            </p>
                            <p>Database User

                            </p>
                            <p>Database permissions

                            </p>
                            <p>Public

                            </p>
                            <p>db_datareader

                            </p>
                            <p>db_datawriter

                            </p>
                            <p>db_owner

                            </p>
                            <p>Database User and Roles/ SQL Server Agent and Jobs

                            </p>
                            <p>SQL Server Logins and Server Roles

                            </p>
                            <p>SQL Server Security

                            </p>
                        </div>
                    </div>
                </div>


                <div class="card">
                    <div class="card-header" id="headingten">
                        <h2 class="mb-0">
                            <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseten" aria-expanded="false" aria-controls="collapseten">
                                10. System Databases


              </button>
                        </h2>
                    </div>
                    <div id="collapseten" class="collapse" aria-labelledby="headingright" data-parent="#accordionExample">
                        <div class="card-body">
                            <p>Master


                            </p>
                            <p><a href="sop/Always On Failover-converted.pdf"> Restore</a>

                            </p>
                            <p>Start up stored procedure in the master database


                            </p>
                            <p>Linked Server Setup , Properties, & Meta Data


                            </p>
                            <p>Model


                            </p>
                            <p>MSDB


                            </p>
                            <p>TempDB


                            </p>
                            <p>TempDB Best Practices


                            </p>
                            <p>Resource database


                            </p>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header" id="headingeleven">
                        <h2 class="mb-0">
                            <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseeleven" aria-expanded="false" aria-controls="collapseeleven">
                                11. System Objects


              </button>
                        </h2>
                    </div>
                    <div id="collapseeleven" class="collapse" aria-labelledby="headingright" data-parent="#accordionExample">
                        <div class="card-body">
                            <p>Linked Server- Introduction


                            </p>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header" id="headingtwelve">
                        <h2 class="mb-0">
                            <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapsetwelve" aria-expanded="false" aria-controls="collapsetwelve">
                                12. Trace Flags


              </button>
                        </h2>
                    </div>
                    <div id="collapsetwelve" class="collapse" aria-labelledby="headingright" data-parent="#accordionExample">
                        <div class="card-body">
                            <p>Introduction about the trace flags
                            </p>
                            <p>Setting up trace flag and viewing the currently used trace flags

                            </p>
                            <p>Local Vs global Vs startup parameter trace flag
                            </p>
                        </div>
                    </div>
                </div>


            </div>
        </div>

    </div>
    <br>
    <br>
    <br>
    <!------------------------------------------------------------------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
         -->
    <!--Replication  -->

    <div class="modal fade create-publication" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content" style="padding: 20px;">
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>

                </div>
                <br>

                <p style="font-size: 13px;color: green;">
                    --Scripting replication configuration. <br> /****** Please Note: For security reasons, all password parameters were scripted with either NULL or an empty string. ******/<br> -- Use the below query for creating the publication<br> --Installing
                    the server as a Distributor. <br></p>
                <br>
                <textarea id="publication" cols="90" rows="13" style="color: #0067b8;font-weight: 600;user-select: text;font-size: 12px;">
                        use master
                        exec sp_adddistributor @distributor = N'LAPTOP-A0TI5JNU\D1', @password = N''
                        GO
                        
                        
                        use [Test]
                        exec sp_replicationdboption @dbname = N'Test', @optname = N'publish', @value = N'true'
                        GO
                        -- Adding the transactional publication
                        use [Test]
                        exec sp_addpublication @publication = N'Trans_Pub_Test', @description = N'Transactional publication of database ''Test'' from Publisher ''LAPTOP-A0TI5JNU\P1''.', @sync_method = N'concurrent', @retention = 0, @allow_push = N'true', @allow_pull = N'true', @allow_anonymous = N'false', @enabled_for_internet = N'false', @snapshot_in_defaultfolder = N'true', @compress_snapshot = N'false', @ftp_port = 21, @ftp_login = N'anonymous', @allow_subscription_copy = N'false', @add_to_active_directory = N'false', @repl_freq = N'continuous', @status = N'active', @independent_agent = N'true', @immediate_sync = N'false', @allow_sync_tran = N'false', @autogen_sync_procs = N'false', @allow_queued_tran = N'false', @allow_dts = N'false', @replicate_ddl = 1, @allow_initialize_from_backup = N'false', @enabled_for_p2p = N'false', @enabled_for_het_sub = N'false'
                        GO
                        
                        
                        exec sp_addpublication_snapshot @publication = N'Trans_Pub_Test', @frequency_type = 4, @frequency_interval = 1, @frequency_relative_interval = 1, @frequency_recurrence_factor = 0, @frequency_subday = 8, @frequency_subday_interval = 1, @active_start_time_of_day = 0, @active_end_time_of_day = 235959, @active_start_date = 0, @active_end_date = 0, @job_login = null, @job_password = null, @publisher_security_mode = 1
                        
                        
                        use [Test]
                        exec sp_addarticle @publication = N'Trans_Pub_Test', @article = N'ACHInterMediate', @source_owner = N'dbo', @source_object = N'ACHInterMediate', @type = N'logbased', @description = null, @creation_script = null, @pre_creation_cmd = N'drop', @schema_option = 0x000000000803509F, @identityrangemanagementoption = N'manual', @destination_table = N'ACHInterMediate', @destination_owner = N'dbo', @vertical_partition = N'false', @ins_cmd = N'CALL sp_MSins_dboACHInterMediate', @del_cmd = N'CALL sp_MSdel_dboACHInterMediate', @upd_cmd = N'SCALL sp_MSupd_dboACHInterMediate'
                        GO</textarea>
                <br>

                <!-- Trigger -->
                <button class="btn" data-clipboard-action="copy" data-clipboard-target="#publication" style="background-color: rgb(252, 252, 252);font-weight: 500;width: 400px;margin: auto;">
                        Copy to clipboard
                    </button>

                </p> <br>
                <br>
                <!-- Trigger -->

            </div>
        </div>
    </div>
    </div>

    <!-------------------------- ETL RPT -->
    <div class="modal fade etl-rpt" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content" style="padding: 20px;">
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>

                </div>
                <br>

                <p style="font-size: 13px;color: green;">
                    -- Adding the transactional pull subscription <br> /****** Begin: Script to be run at Subscriber ******/ <br></p>
                <br>
                <textarea id="etl-rpt" style="color: #0067b8;font-weight: 600;user-select: text;font-size: 12px;">
                    use [ETL_RPT_Coreissue]
                    exec sp_addpullsubscription @publisher = N'LAPTOP-A0TI5JNU\SERVER02', @publication = N'Tran_Pub_0505', @publisher_db = N'ETL_Coreissue', @independent_agent = N'True', @subscription_type = N'pull', @description = N'', @update_mode = N'read only', @immediate_sync = 0
                    
                    exec sp_addpullsubscription_agent @publisher = N'LAPTOP-A0TI5JNU\SERVER02', @publisher_db = N'ETL_Coreissue', @publication = N'Tran_Pub_0505', @distributor = N'LAPTOP-A0TI5JNU\SERVER02', @distributor_security_mode = 1, @distributor_login = N'', @distributor_password = N'', @enabled_for_syncmgr = N'False', @frequency_type = 64, @frequency_interval = 0, @frequency_relative_interval = 0, @frequency_recurrence_factor = 0, @frequency_subday = 0, @frequency_subday_interval = 0, @active_start_time_of_day = 0, @active_end_time_of_day = 235959, @active_start_date = 0, @active_end_date = 0, @alt_snapshot_folder = N'', @working_directory = N'', @use_ftp = N'False', @job_login = null, @job_password = null, @publication_type = 0
                    GO</textarea>
                <!-- Trigger -->
                <button class="btn" data-clipboard-action="copy" data-clipboard-target="#etl-rpt" style="background-color: rgb(252, 252, 252);font-weight: 500;width: 400px;margin: auto;">
                    Copy to clipboard
                </button>
                <br>
                <p style="font-size: 13px;color: green;">
                    /****** End: Script to be run at Subscriber ******/ <br><br> /****** Begin: Script to be run at Publisher ******/ <br> /*use [ETL_Coreissue] <br> -- Parameter @sync_type is scripted as 'automatic', please adjust when appropriate. <br>                    exec sp_addsubscription @publication = N'Tran_Pub_0505', @subscriber = N'LAPTOP-A0TI5JNU\SERVER03', @destination_db = N'ETL_RPT_Coreissue', @sync_type = N'Automatic', @subscription_type = N'pull', @update_mode = N'read only' <br> */
                    <br> /****** End: Script to be run at Publisher ******/<br></p>



                </p> <br>
                <br>
                <!-- Trigger -->

            </div>
        </div>
    </div>
    </div>


   <!-------------------------- Transact - Sql -->
   <div class="modal fade transact-sql" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content" style="padding: 20px;">
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>

            </div>
            <br>

            <p style="font-size: 13px;color: green;">
                --Transact-SQL Script to Monitor Replication Status <br><br>

/*This script helps you to answer common questions such as:<br>
Ref Link--https://basitaalishan.com/2012/07/25/transact-sql-script-to-monitor-replication-status/<br><br>

Is my transactional replication healthy?<br>
How far behind is my transactional subscription?<br>
How long will it take a transaction committed now to reach a Subscriber in transactional replication?*/<br></p>
            <br>
            <textarea id="transactsql" cols="90" rows="13" style="color: #0067b8;font-weight: 600;user-select: text;font-size: 12px;">
                USE [distribution]
 
IF OBJECT_ID('Tempdb.dbo.#ReplStats') IS NOT NULL
    DROP TABLE #ReplStats
 
CREATE TABLE [dbo].[#ReplStats] (
    [DistributionAgentName] [nvarchar](100) NOT NULL
    ,[DistributionAgentStartTime] [datetime] NOT NULL
    ,[DistributionAgentRunningDurationInSeconds] [int] NOT NULL
    ,[IsAgentRunning] [bit] NULL
    ,[ReplicationStatus] [varchar](14) NULL
    ,[LastSynchronized] [datetime] NOT NULL
    ,[Comments] [nvarchar](max) NOT NULL
    ,[Publisher] [sysname] NOT NULL
    ,[PublicationName] [sysname] NOT NULL
    ,[PublisherDB] [sysname] NOT NULL
    ,[Subscriber] [nvarchar](128) NULL
    ,[SubscriberDB] [sysname] NULL
    ,[SubscriptionType] [varchar](64) NULL
    ,[DistributionDB] [sysname] NULL
    ,[Article] [sysname] NOT NULL
    ,[UndelivCmdsInDistDB] [int] NULL
    ,[DelivCmdsInDistDB] [int] NULL
    ,[CurrentSessionDeliveryRate] [float] NOT NULL
    ,[CurrentSessionDeliveryLatency] [int] NOT NULL
    ,[TotalTransactionsDeliveredInCurrentSession] [int] NOT NULL
    ,[TotalCommandsDeliveredInCurrentSession] [int] NOT NULL
    ,[AverageCommandsDeliveredInCurrentSession] [int] NOT NULL
    ,[DeliveryRate] [float] NOT NULL
    ,[DeliveryLatency] [int] NOT NULL
    ,[TotalCommandsDeliveredSinceSubscriptionSetup] [int] NOT NULL
    ,[SequenceNumber] [varbinary](16) NULL
    ,[LastDistributerSync] [datetime] NULL
    ,[Retention] [int] NULL
    ,[WorstLatency] [int] NULL
    ,[BestLatency] [int] NULL
    ,[AverageLatency] [int] NULL
    ,[CurrentLatency] [int] NULL
    ) ON [PRIMARY]
 
INSERT INTO #ReplStats
SELECT da.[name] AS [DistributionAgentName]
    ,dh.[start_time] AS [DistributionAgentStartTime]
    ,dh.[duration] AS [DistributionAgentRunningDurationInSeconds]
    ,md.[isagentrunningnow] AS [IsAgentRunning]
    ,CASE md.[status]
        WHEN 1
            THEN '1 - Started'
        WHEN 2
            THEN '2 - Succeeded'
        WHEN 3
            THEN '3 - InProgress'
        WHEN 4
            THEN '4 - Idle'
        WHEN 5
            THEN '5 - Retrying'
        WHEN 6
            THEN '6 - Failed'
        END AS [ReplicationStatus]
    ,dh.[time] AS [LastSynchronized]
    ,dh.[comments] AS [Comments]
    ,md.[publisher] AS [Publisher]
    ,da.[publication] AS [PublicationName]
    ,da.[publisher_db] AS [PublisherDB]
    ,CASE
        WHEN da.[anonymous_subid] IS NOT NULL
            THEN UPPER(da.[subscriber_name])
        ELSE UPPER(s.[name])
        END AS [Subscriber]
    ,da.[subscriber_db] AS [SubscriberDB]
    ,CASE da.[subscription_type]
        WHEN '0'
            THEN 'Push'
        WHEN '1'
            THEN 'Pull'
        WHEN '2'
            THEN 'Anonymous'
        ELSE CAST(da.[subscription_type] AS [varchar](64))
        END AS [SubscriptionType]
    ,md.[distdb] AS [DistributionDB]
    ,ma.[article] AS [Article]
    ,ds.[UndelivCmdsInDistDB]
    ,ds.[DelivCmdsInDistDB]
    ,dh.[current_delivery_rate] AS [CurrentSessionDeliveryRate]
    ,dh.[current_delivery_latency] AS [CurrentSessionDeliveryLatency]
    ,dh.[delivered_transactions] AS [TotalTransactionsDeliveredInCurrentSession]
    ,dh.[delivered_commands] AS [TotalCommandsDeliveredInCurrentSession]
    ,dh.[average_commands] AS [AverageCommandsDeliveredInCurrentSession]
    ,dh.[delivery_rate] AS [DeliveryRate]
    ,dh.[delivery_latency] AS [DeliveryLatency]
    ,dh.[total_delivered_commands] AS [TotalCommandsDeliveredSinceSubscriptionSetup]
    ,dh.[xact_seqno] AS [SequenceNumber]
    ,md.[last_distsync] AS [LastDistributerSync]
    ,md.[retention] AS [Retention]
    ,md.[worst_latency] AS [WorstLatency]
    ,md.[best_latency] AS [BestLatency]
    ,md.[avg_latency] AS [AverageLatency]
    ,md.[cur_latency] AS [CurrentLatency]
FROM [distribution]..[MSdistribution_status] ds
INNER JOIN [distribution]..[MSdistribution_agents] da ON da.[id] = ds.[agent_id]
INNER JOIN [distribution]..[MSArticles] ma ON ma.publisher_id = da.publisher_id
    AND ma.[article_id] = ds.[article_id]
INNER JOIN [distribution]..[MSreplication_monitordata] md ON [md].[job_id] = da.[job_id]
INNER JOIN [distribution]..[MSdistribution_history] dh ON [dh].[agent_id] = md.[agent_id]
    AND md.[agent_type] = 3
INNER JOIN [master].[sys].[servers] s ON s.[server_id] = da.[subscriber_id]

--Created WHEN your publication has the immediate_sync property set to true. This property dictates 
--whether snapshot is available all the time for new subscriptions to be initialized. 
--This affects the cleanup behavior of transactional replication. If this property is set to true, 
--the transactions will be retained for max retention period instead of it getting cleaned up
--as soon as all the subscriptions got the change. 


WHERE da.[subscriber_db] <> 'virtual'
    AND da.[anonymous_subid] IS NULL
    AND dh.[start_time] = (
        SELECT TOP 1 start_time
        FROM [distribution]..[MSdistribution_history] a
        INNER JOIN [distribution]..[MSdistribution_agents] b ON a.[agent_id] = b.[id]
            AND b.[subscriber_db] <> 'virtual'
        WHERE [runstatus] <> 1
        ORDER BY [start_time] DESC
        )
    AND dh.[runstatus] <> 1
 
SELECT 'Transactional Replication Summary' AS [Comments];
 
SELECT [DistributionAgentName]
    ,[DistributionAgentStartTime]
    ,[DistributionAgentRunningDurationInSeconds]
    ,[IsAgentRunning]
    ,[ReplicationStatus]
    ,[LastSynchronized]
    ,[Comments]
    ,[Publisher]
    ,[PublicationName]
    ,[PublisherDB]
    ,[Subscriber]
    ,[SubscriberDB]
    ,[SubscriptionType]
    ,[DistributionDB]
    ,SUM([UndelivCmdsInDistDB]) AS [UndelivCmdsInDistDB]
    ,SUM([DelivCmdsInDistDB]) AS [DelivCmdsInDistDB]
    ,[CurrentSessionDeliveryRate]
    ,[CurrentSessionDeliveryLatency]
    ,[TotalTransactionsDeliveredInCurrentSession]
    ,[TotalCommandsDeliveredInCurrentSession]
    ,[AverageCommandsDeliveredInCurrentSession]
    ,[DeliveryRate]
    ,[DeliveryLatency]
    ,[TotalCommandsDeliveredSinceSubscriptionSetup]
    ,[SequenceNumber]
    ,[LastDistributerSync]
    ,[Retention]
    ,[WorstLatency]
    ,[BestLatency]
    ,[AverageLatency]
    ,[CurrentLatency]
FROM #ReplStats
GROUP BY [DistributionAgentName]
    ,[DistributionAgentStartTime]
    ,[DistributionAgentRunningDurationInSeconds]
    ,[IsAgentRunning]
    ,[ReplicationStatus]
    ,[LastSynchronized]
    ,[Comments]
    ,[Publisher]
    ,[PublicationName]
    ,[PublisherDB]
    ,[Subscriber]
    ,[SubscriberDB]
    ,[SubscriptionType]
    ,[DistributionDB]
    ,[CurrentSessionDeliveryRate]
    ,[CurrentSessionDeliveryLatency]
    ,[TotalTransactionsDeliveredInCurrentSession]
    ,[TotalCommandsDeliveredInCurrentSession]
    ,[AverageCommandsDeliveredInCurrentSession]
    ,[DeliveryRate]
    ,[DeliveryLatency]
    ,[TotalCommandsDeliveredSinceSubscriptionSetup]
    ,[SequenceNumber]
    ,[LastDistributerSync]
    ,[Retention]
    ,[WorstLatency]
    ,[BestLatency]
    ,[AverageLatency]
    ,[CurrentLatency]
 
SELECT 'Transactional Replication Summary Details' AS [Comments];
 
SELECT [Publisher]
    ,[PublicationName]
    ,[PublisherDB]
    ,[Article]
    ,[Subscriber]
    ,[SubscriberDB]
    ,[SubscriptionType]
    ,[DistributionDB]
    ,SUM([UndelivCmdsInDistDB]) AS [UndelivCmdsInDistDB]
    ,SUM([DelivCmdsInDistDB]) AS [DelivCmdsInDistDB]
FROM #ReplStats
GROUP BY [Publisher]
    ,[PublicationName]
    ,[PublisherDB]
    ,[Article]
    ,[Subscriber]
    ,[SubscriberDB]
    ,[SubscriptionType]
    ,[DistributionDB]</textarea>
            <!-- Trigger -->
            <button class="btn" data-clipboard-action="copy" data-clipboard-target="#transactsql" style="background-color: rgb(252, 252, 252);font-weight: 500;width: 400px;margin: auto;">
                Copy to clipboard
            </button>
            <br>
           



            </p> <br>
            <br>
            <!-- Trigger -->

        </div>
    </div>
</div>
</div>


<!-------------------------- ETL RPT -->
<div class="modal fade tsqlcode" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content" style="padding: 20px;">
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>

            </div>
            <br>

            <p style="font-size: 13px;color: green;">
                /*T-SQL code to review replication configuration <br>
I have configured the snapshot replication and transactional replication on two instances of my machine. Using SQL dynamic management (DMVs), we can check the configuration of replication. To review the configuration of replication we can use T-SQL code. Script code populates the following:<br>
Reference Link--https://codingsight.com/sql-server-database-replication/<br>
Subscriber database name.<br>
Publisher Name.<br>
Subscription type.<br>
Publisher database.<br>
Replication Agent Name.<br>
Below is the script:*/<br></p>
            <br>
            <textarea id="tsqlcode" cols="90" rows="13" style="color: #0067b8;font-weight: 600;user-select: text;font-size: 12px;">
                SELECT DistributionAgent.subscriber_db 
       [Subscriber DB], 
       DistributionAgent.publication                              [PUB Name], 
       RIGHT(LEFT(DistributionAgent.NAME, Len(DistributionAgent.NAME) - ( Len( 
                                                DistributionAgent.id) + 1 )), 
       Len(LEFT( 
       DistributionAgent.NAME, Len(DistributionAgent.NAME) - 
                               ( 
                                                    Len( 
       DistributionAgent.id) + 1 ))) - ( 
       10 + Len(DistributionAgent.publisher_db) + ( 
       CASE 
       WHEN 
       DistributionAgent.publisher_db = 'ALL' 
                                           THEN 1 
       ELSE 
                                             Len( 
       DistributionAgent.publication) + 2 
          END ) ))              [SUBSCRIBER], 
       ( CASE 
           WHEN DistributionAgent.subscription_type = '0' THEN 'Push' 
           WHEN DistributionAgent.subscription_type = '1' THEN 'Pull' 
           WHEN DistributionAgent.subscription_type = '2' THEN 'Anonymous' 
           ELSE Cast(DistributionAgent.subscription_type AS VARCHAR) 
         END ) 
       [Subscrition Type], 
       DistributionAgent.publisher_db + ' - ' 
       + Cast(DistributionAgent.publisher_database_id AS VARCHAR) 
       [Publisher Database], 
       DistributionAgent.NAME 
       [Pub - DB - Publication - SUB - AgentID] 
FROM   distribution.dbo.msdistribution_agents DistributionAgent 
WHERE  DistributionAgent.subscriber_db <> 'virtual'</textarea>
            <!-- Trigger -->
            <button class="btn" data-clipboard-action="copy" data-clipboard-target="#tsqlcode" style="background-color: rgb(252, 252, 252);font-weight: 500;width: 400px;margin: auto;">
                Copy to clipboard
            </button>
            <br>
            



            </p> <br>
            <br>
            <!-- Trigger -->

        </div>
    </div>
</div>
</div>
    <!------------------------------------------------------------------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
         -->
    <!-- Online rebuild indexes  -->



    <div class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content" style="padding: 20px;">
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>

                </div>
                <br>
                <p style="font-size: 13px;"> /* <br> -- TO rebuild the index online use the below query. <br> -- Online rebuild helps in reduce the blocking. <br> -- use offline option when the table is not very trasactional or we do the rebuild in a downtime. <br> -- please confirm
                    the maxdop value with the project team before execution. <br>*/ </p>


                </span>


                <input id="foo" value=" alter index [index name] on table name rebuild with (ONLINE = ON, MAXDOP = 2)" style="color: #0067b8;font-weight: 600;">

                <!-- Trigger -->
                <button class="btn" data-clipboard-target="#foo">
    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/04/Copy_font_awesome.svg/512px-Copy_font_awesome.svg.png" alt="Copy to clipboard" width="20px">
</button> <br>
                <p style="font-size: 13px;">--TO Reorganize use the below query</p>
                <input id="fo" value=" alter index [index name] on table name reorganize" style="color: #0067b8;font-weight: 600;">

                <!-- Trigger -->
                <button class="btn" data-clipboard-target="#fo">
<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/04/Copy_font_awesome.svg/512px-Copy_font_awesome.svg.png" alt="Copy to clipboard" width="20px">
</button> <br>
            </div>
        </div>
    </div>
    </div>


    <!------------------------------------------------------------- fragmentation ------------------------------------------------------------->





    <div class="modal fade bd-example-modal-lg1" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content" style="padding: 20px;">
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>

                </div>
                <br>
                <p style="font-size: 11px;"> --As data is modified in a database, the database and its indexes become fragmented. <br> --As indexes become fragmented, ordered data retrieval becomes less efficient and reduces database performance.<br> --We use fragmentation for the
                    performance and use DMV "sys.dm_db_index_physical_stats" for the getting the index fragmentation details.<br> --Below query is used to find out the fragmentation level in percentage. <br> </p>





                <!--    <p style="color: #0067b8;font-weight: 600;user-select: text;">SELECT <br> ps.database_id AS 'databaseID' <br> , QUOTENAME(DB_NAME(ps.database_id)) AS 'databaseName' <br> , ps.[object_id] AS 'objectID' <br> , OBJECT_NAME(ps.[object_id]) AS 'TableName' <br> , ps.index_id AS 'indexID' <br> , si.name
                    AS 'IndexName' <br> , ps.avg_fragmentation_in_percent AS 'fragmentation' <br> , ps.page_count AS 'page_count' <br> , GETDATE() AS 'scanDate' <br> FROM sys.dm_db_index_physical_stats(DB_ID() -- databaseid for which we need to check
                    fragmentation <br> , OBJECT_ID(N'ccard_primary_NCpartitioned') -- objectid for which we need to check fragmentation, keep NULL for all Objects. <br> , NULL , NULL, 'LIMITED') AS ps <br> JOIN SYS.INDEXES SI on PS.object_id = si.object_id
                    and ps.index_id = si.index_id <br> --WHERE avg_fragmentation_in_percent >= 10" </p> <br>
                <br> --><br><br>
                <textarea id="fragmentation" cols="90" rows="13" style="color: #0067b8;font-weight: 600;user-select: text;font-size: 12px;">
                    SELECT
                    ps.database_id AS 'databaseID'
                    , QUOTENAME(DB_NAME(ps.database_id)) AS 'databaseName'
                    , ps.[object_id] AS 'objectID'
                    , OBJECT_NAME(ps.[object_id]) AS 'TableName'
                    , ps.index_id AS 'indexID'
                    , si.name AS 'IndexName'
                    , ps.avg_fragmentation_in_percent AS 'fragmentation'
                    , ps.page_count AS 'page_count'
                    , GETDATE() AS 'scanDate'
                    FROM sys.dm_db_index_physical_stats(DB_ID() -- databaseid for which we need to check fragmentation 
                    , OBJECT_ID(N'ccard_primary_NCpartitioned') -- objectid for which we need to check fragmentation, keep NULL for all Objects. 
                    , NULL , NULL, 'LIMITED') AS ps
                    JOIN SYS.INDEXES SI on PS.object_id = si.object_id and ps.index_id = si.index_id 
                    --WHERE avg_fragmentation_in_percent >= 10</textarea>
                <br>

                <!-- Trigger -->
                <button class="btn" data-clipboard-action="copy" data-clipboard-target="#fragmentation" style="background-color: rgb(253, 252, 252);font-weight: 500;width: 400px;margin: auto;">
                    Copy to clipboard
                </button>

                <!-- Trigger -->



            </div>
        </div>
    </div>
    </div>




</body>

</html>